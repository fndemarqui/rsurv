---
title: "Introduction to the R package rsurv"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to the R package rsurv}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In this document we show how to use the __rsurv__ package to simulate different types of right-censored survival data. 

## Type I right-censored survival data

In the code below we show how to simulate a sample of Type I right-censored survival data, assuming that the failure times are generated from an accelerated failure time model with loglogistic baseline distribution. In addition, assume that we wish to consider two
exploratory variables, say age and sex, and we want to include an interaction effect between them. Such a task can be easily accomplished by using the function `raftreg()` along with the function `qllogis()` available in the package __flexsurv__.

```{r example, message = FALSE}
library(rsurv)
library(dplyr)
library(survstan)

set.seed(1234567890)

n <-  1000
tau <- 10  # maximum follow up time
simdata <- data.frame(
  age = rnorm(n),
  sex = sample(c("f", "m"), size = n, replace = TRUE)
) %>%
  mutate(
    t = raftreg(runif(n), ~ age*sex, beta = c(1, 2, -0.5), 
                dist = "llogis", shape = 1.5, scale = 1, package = "flexsurv"),
  ) %>%
  rowwise() %>%
  mutate(
    time = min(t, tau),
    status = as.numeric(time == t)
  ) 

# visualizing the simulated data:
glimpse(simdata)

fit <- aftreg(
  Surv(time, status) ~ age*sex,
  data = simdata, dist = "loglogistic"
)
estimates(fit)

```

## Type II right-censored survival data

Suppose one wishes to simulate an accelerated failure test. In the example presented below we consider $n=20$ test units, with a pre-specified number of $m=15$ failures  (Type II right-censoring). A lognormal distributions with parameters $\mu = -1$ and $\sigma = 1$ is assumed for the baseline distribution. Temperature is considered as the acceleration factor. Specifically, we consider 4 levels of temperature (300, 350, 400, 500 Kelvin degrees), and the following linear predictor is: $x\beta = -0.05\times \mbox{temperature}$.
  
```{r}
library(rsurv)
library(dplyr)

set.seed(1234567890)
n <- 20 # number of test units
m <- 15 # number of failures

#simulating the failure times:
simdata <- data.frame(
  temperature = rep(c(300, 350, 400, 500), each = 5)    
) %>%                                                                   
  mutate(                                                            
    t = raftreg(runif(n), ~ 1/temperature, beta = 580, 
                dist = "lnorm", meanlog = 3, sdlog = 0.5)                                          
  ) %>%
  arrange(t) # sorting the generated data

# obtaining 15-th failure time:
tau <- simdata$t[m]

# including type II censoring:
simdata <- simdata %>%
  rowwise() %>%
  mutate(
    time = min(t, tau),
    status = as.numeric(time == t)
  )
simdata
```

## Type III (random censoring) right-censored survival data


```{r}
library(rsurv)
library(dplyr)

set.seed(1234567890)
n <- 20
covariates <- data.frame(
  stage = sample(c("I", "II", "III", "IV"), size = n, replace = TRUE)
) 

simdata1 <- covariates %>%
  mutate(
    t = rphreg(runif(n), ~stage, beta = c(0.2, 0.35, 1.2), dist = "weibull", shape = 2.3, scale = 1),
    c = rexp(n, rate = 0.1)
  ) %>%
  rowwise() %>%
  mutate(
    time = min(t, tau),
    status = as.numeric(time == t)
  ) %>%
  select(-c(t, c))
glimpse(simdata1)

att <- attributes(simdata1$time)
str(att)
unique(att$model.matrix)
```

